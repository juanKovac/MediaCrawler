# 版本回退指南

本文档详细说明如何在项目调整过程中保护当前版本并实现安全回退。

## 📋 目录

- [当前版本状态](#当前版本状态)
- [版本保护方案](#版本保护方案)
- [版本回退方法](#版本回退方法)
- [安全调整建议](#安全调整建议)
- [常用命令速查](#常用命令速查)
- [注意事项](#注意事项)

## 🎯 当前版本状态

- **当前版本**：0.1.1
- **Git标签**：v0.1.1（已创建）
- **稳定提交**：a9f9c40 - fix: 修复Windows环境下Git钩子和发布脚本的编码问题
- **工作分支**：feature/adjustments
- **主分支**：main

## 🛡️ 版本保护方案

### 1. Git标签保护
已为当前稳定版本创建标签 `v0.1.1`，这个标签永久保存了当前状态，即使后续有任何修改也不会影响这个版本。

### 2. 分支隔离
创建了专门的调整分支 `feature/adjustments`，所有修改都在这个分支进行，主分支保持稳定。

### 3. 提交历史保护
所有的提交历史都被完整保存，可以回退到任意历史提交点。

## 🔄 版本回退方法

### 方法一：回退到标记的稳定版本（推荐）

```bash
# 回退到v0.1.1稳定版本
git checkout v0.1.1

# 查看当前状态
git status

# 如果需要基于这个版本继续开发
git checkout -b new-branch-name v0.1.1
```

**适用场景**：需要回到确定的稳定版本

### 方法二：回退到主分支最新状态

```bash
# 切换回主分支
git checkout main

# 查看主分支状态
git log --oneline -5

# 如果需要丢弃当前分支的所有修改
git branch -D feature/adjustments
```

**适用场景**：放弃当前调整，回到主分支继续开发

### 方法三：回退到特定提交

```bash
# 回退到特定提交（当前最新提交）
git checkout a9f9c40

# 或者重置到特定提交（危险操作，会丢失后续提交）
git reset --hard a9f9c40

# 查看提交历史选择回退点
git log --oneline -10
```

**适用场景**：需要回到特定的历史状态

### 方法四：撤销特定修改

```bash
# 撤销工作区的修改（未提交）
git checkout -- <文件名>

# 撤销暂存区的修改
git reset HEAD <文件名>

# 撤销最近的提交（保留修改）
git reset --soft HEAD~1

# 撤销最近的提交（丢弃修改）
git reset --hard HEAD~1
```

**适用场景**：只需要撤销部分修改

## 💡 安全调整建议

### 1. 分支管理策略

```bash
# 当前在调整分支进行工作
git branch  # 查看当前分支

# 定期提交小的修改
git add .
git commit -m "描述具体的修改内容"

# 查看修改历史
git log --oneline
```

### 2. 测试验证流程

```bash
# 在合并前先测试
python main.py  # 或其他测试命令

# 检查语法错误
python -m py_compile scripts/*.py

# 运行版本管理工具测试
python scripts/version_manager.py --current
```

### 3. 合并到主分支

```bash
# 切换到主分支
git checkout main

# 合并调整分支
git merge feature/adjustments

# 如果需要创建新版本
python scripts/version_manager.py --auto

# 推送到远程仓库
git push origin main
```

### 4. 清理工作

```bash
# 删除已合并的分支
git branch -d feature/adjustments

# 查看所有分支
git branch -a
```

## ⚡ 常用命令速查

### 查看状态
```bash
git status                    # 查看工作区状态
git branch                    # 查看分支
git log --oneline -10         # 查看提交历史
git tag -l                    # 查看所有标签
python scripts/version_manager.py --current  # 查看当前版本
```

### 快速回退
```bash
git checkout main             # 回到主分支
git checkout v0.1.1           # 回到稳定版本
git checkout a9f9c40          # 回到特定提交
```

### 紧急恢复
```bash
git reflog                    # 查看所有操作历史
git checkout HEAD~1           # 回退一个提交
git reset --hard HEAD~1       # 强制回退（危险）
```

## ⚠️ 注意事项

### 1. 数据安全
- 使用 `git reset --hard` 前请确认，这会永久删除修改
- 重要修改前建议先创建备份分支
- 定期推送到远程仓库保护代码

### 2. 版本管理
- 每次重要修改后都应该更新版本号
- 使用有意义的提交信息
- 遵循语义化版本控制规范

### 3. 团队协作
- 推送前确保本地测试通过
- 不要直接在主分支进行大的修改
- 使用Pull Request进行代码审查

### 4. 紧急情况处理
如果遇到严重问题无法解决：

```bash
# 1. 立即回到稳定版本
git checkout v0.1.1

# 2. 创建紧急修复分支
git checkout -b hotfix/emergency-fix

# 3. 联系技术支持或查看文档
# docs/版本管理指南.md
# docs/常见问题.md
```

## 📞 获取帮助

- 查看版本管理指南：`docs/版本管理指南.md`
- 查看常见问题：`docs/常见问题.md`
- 使用版本管理工具：`python scripts/version_manager.py --help`
- 使用发布工具：`python scripts/release.py --help`

---

**记住**：当前稳定版本 `v0.1.1` 已经被永久保护，无论如何修改都可以安全回退！